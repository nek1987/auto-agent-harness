{
  "schema_version": "2.0",
  "meta": {
    "generated_at": "2026-01-10T11:56:23.262Z",
    "slug": "cjharmath-py-alembic-patterns",
    "source_url": "https://github.com/CJHarmath/claude-agents-skills/tree/main/skills/py-alembic-patterns",
    "source_ref": "main",
    "model": "claude",
    "analysis_version": "2.0.0",
    "source_type": "community",
    "content_hash": "e9af20862076147b8d3fd595c9e9e7e44cbb0e2e91f6c3eae368c3b89bd35602",
    "tree_hash": "b3653e6c88853bbbe8331b2f2423f5aa9b3b57d419725b2da6f63458e3eb65f3"
  },
  "skill": {
    "name": "py-alembic-patterns",
    "description": "Alembic migration patterns for PostgreSQL. Use when creating migrations, reviewing autogenerated migrations, or handling schema changes safely.",
    "summary": "Alembic migration patterns for PostgreSQL. Use when creating migrations, reviewing autogenerated mig...",
    "icon": "üóÑÔ∏è",
    "version": "1.0.0",
    "author": "CJHarmath",
    "license": "MIT",
    "category": "coding",
    "tags": [
      "database",
      "postgresql",
      "alembic",
      "migration",
      "sqlalchemy"
    ],
    "supported_tools": [
      "claude",
      "codex",
      "claude-code"
    ],
    "risk_factors": []
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "Pure documentation skill containing only markdown content with example code patterns. No executable code, scripts, network operations, or file system access beyond reading the skill file. Contains educational best practices for database migrations.",
    "risk_factor_evidence": [],
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 1,
    "total_lines": 366,
    "audit_model": "claude",
    "audited_at": "2026-01-10T11:56:23.262Z"
  },
  "content": {
    "user_title": "Review and write safe Alembic migrations",
    "value_statement": "Database migrations are high-risk operations where mistakes cause data loss or downtime. This skill provides battle-tested patterns for creating, reviewing, and applying Alembic migrations safely in production environments.",
    "seo_keywords": [
      "Alembic migration patterns",
      "PostgreSQL migrations",
      "SQLAlchemy migrations",
      "database schema changes",
      "migration review checklist",
      "safe database migrations",
      "Claude Code migration tool",
      "Codex database patterns",
      "Alembic best practices",
      "PostgreSQL schema management"
    ],
    "actual_capabilities": [
      "Generate migration files with proper structure and documentation headers",
      "Review autogenerated migrations for dangerous patterns like column drops",
      "Implement safe patterns for adding non-nullable columns with backfill",
      "Handle large table migrations with concurrent indexes to avoid locks",
      "Create data migrations using batch updates for existing records",
      "Manage PostgreSQL enum types and multi-head migration branches"
    ],
    "limitations": [
      "Does not execute migrations automatically or connect to databases",
      "Does not generate migration files directly from model definitions",
      "Does not provide rollback scripts for complex data transformations",
      "Does not replace human review of migration impact on production data"
    ],
    "use_cases": [
      {
        "target_user": "Backend developers",
        "title": "Write safe production migrations",
        "description": "Create migrations that include downgrade paths, handle data correctly, and avoid table locks in production."
      },
      {
        "target_user": "DevOps engineers",
        "title": "Review migrations before deploy",
        "description": "Verify proposed migrations follow safety patterns and will not cause downtime or data loss during deployment."
      },
      {
        "target_user": "Database administrators",
        "title": "Audit migration patterns",
        "description": "Ensure team follows PostgreSQL best practices for constraint naming, index creation, and enum management."
      }
    ],
    "prompt_templates": [
      {
        "title": "Basic migration help",
        "scenario": "Need to create a new migration",
        "prompt": "Help me create an Alembic migration to [describe your schema change]. Include the upgrade and downgrade functions with proper structure."
      },
      {
        "title": "Review autogenerated",
        "scenario": "Checking autogenerated migration safety",
        "prompt": "Review this autogenerated Alembic migration for dangerous patterns. Point out any operations that could cause data loss or downtime: [paste migration code]"
      },
      {
        "title": "Handle large tables",
        "scenario": "Migrating tables with millions of rows",
        "prompt": "I need to [describe change] on a table with millions of rows. Show me how to do this safely using concurrent operations and batch updates to avoid locks."
      },
      {
        "title": "Complex data migration",
        "scenario": "Transforming existing data during schema change",
        "prompt": "I am adding a new column and need to backfill existing rows based on complex business logic. Show me how to implement this as a data migration in Alembic with proper connection handling."
      }
    ],
    "output_examples": [
      {
        "input": "Create a migration to rename a column from 'name' to 'full_name' in the users table",
        "output": [
          "‚ùå DANGEROUS - Autogenerated migration that loses data:",
          "  op.drop_column('users', 'name')  # All data lost!",
          "  op.add_column('users', 'full_name', sa.String())",
          "",
          "‚úÖ CORRECT - Manual rename preserves data:",
          "  op.alter_column('users', 'name', new_column_name='full_name')",
          "",
          "The downgrade reverses this operation correctly.",
          "Key principle: Never let autogenerate handle renames."
        ]
      }
    ],
    "best_practices": [
      "Always implement downgrade functions that fully reverse the upgrade, even if you never expect to use them",
      "Review every autogenerated migration for dangerous patterns like drop+add column operations that lose data",
      "Use CONCURRENTLY for index creation on large tables and batch data migrations to prevent production locks"
    ],
    "anti_patterns": [
      "Relying on autogenerated migrations without manual review, especially for column or table renames",
      "Adding NOT NULL columns without backfilling existing rows, causing migrations to fail on populated tables",
      "Skipping downgrade implementation with just 'pass', making rollback impossible when you need it most"
    ],
    "faq": [
      {
        "question": "Does this skill execute migrations against my database?",
        "answer": "No. This skill provides patterns and code examples. You run the migrations yourself using Alembic commands in your project."
      },
      {
        "question": "What schema changes does autogenerate handle correctly?",
        "answer": "Autogenerate handles table creation, column addition and removal, type changes, foreign keys, and index changes reliably. Always verify the output."
      },
      {
        "question": "How do I handle migrations on tables with millions of rows?",
        "answer": "Use CONCURRENTLY for index creation, batch data migrations in chunks, and consider adding columns as nullable first before adding constraints."
      },
      {
        "question": "Is my data safe when using these patterns?",
        "answer": "These patterns are designed to prevent data loss. Always backup production databases before running migrations and test downgrade paths first."
      },
      {
        "question": "Can I use these patterns with databases other than PostgreSQL?",
        "answer": "Some patterns like CONCURRENTLY are PostgreSQL-specific. General migration structure and review patterns work with any SQLAlchemy-supported database."
      },
      {
        "question": "How does this compare to other migration tools?",
        "answer": "Alembic is the official SQLAlchemy migration tool. These patterns address common pain points and safety issues specific to Alembic's autogenerate feature."
      }
    ]
  },
  "file_structure": [
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "SKILL.md"
    }
  ]
}
