{
  "schema_version": "2.0",
  "meta": {
    "generated_at": "2026-01-10T10:21:16.740Z",
    "slug": "agentworkforce-debugging-websocket-issues",
    "source_url": "https://github.com/AgentWorkforce/relay/tree/main/.claude/skills/debugging-websocket-issues",
    "source_ref": "main",
    "model": "claude",
    "analysis_version": "2.0.0",
    "source_type": "community",
    "content_hash": "d9bdf8bfdc57974ffd7b86a5d0059f81c949d846b89b65ef7c3f1eb99565ba63",
    "tree_hash": "7c527d67188536c845f90b6ef40cbfce529505c91e51c68c3e383c44d6b60541"
  },
  "skill": {
    "name": "debugging-websocket-issues",
    "description": "Use when seeing WebSocket errors like \"Invalid frame header\", \"RSV1 must be clear\", or \"WS_ERR_UNEXPECTED_RSV_1\" - covers multiple WebSocketServer conflicts, compression issues, and raw frame debugging techniques",
    "summary": "Use when seeing WebSocket errors like \"Invalid frame header\", \"RSV1 must be clear\", or \"WS_ERR_UNEXP...",
    "icon": "ðŸ”Œ",
    "version": "1.0.0",
    "author": "AgentWorkforce",
    "license": "MIT",
    "category": "coding",
    "tags": [
      "websocket",
      "debugging",
      "node",
      "troubleshooting"
    ],
    "supported_tools": [
      "claude",
      "codex",
      "claude-code"
    ],
    "risk_factors": []
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "Pure documentation skill containing only markdown content with no executable code. Contains debugging guidance and code examples for development purposes only. No scripts, network calls, filesystem access, or external command execution.",
    "risk_factor_evidence": [],
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 1,
    "total_lines": 129,
    "audit_model": "claude",
    "audited_at": "2026-01-10T10:21:16.740Z"
  },
  "content": {
    "user_title": "Debug WebSocket Connection Issues",
    "value_statement": "WebSocket errors like 'Invalid frame header' or 'RSV1 must be clear' are frustrating and hard to diagnose. This skill provides clear patterns to identify the root cause and fix multiple WebSocketServer conflicts, compression mismatches, and raw frame issues.",
    "seo_keywords": [
      "websocket debugging",
      "Invalid frame header fix",
      "RSV1 must be clear",
      "WebSocketServer conflict",
      "Node.js WebSocket",
      "ws library troubleshooting",
      "WebSocket compression",
      "1006 abnormal closure",
      "Claude Code WebSocket",
      "Claude WebSocket debugging"
    ],
    "actual_capabilities": [
      "Diagnose 'Invalid frame header' and 'RSV1 must be clear' WebSocket errors",
      "Identify multiple WebSocketServer conflicts on the same HTTP server",
      "Detect raw HTTP being written to upgraded WebSocket sockets",
      "Debug WebSocket compression mismatch issues between client and server",
      "Inspect raw WebSocket frames using hex patterns and byte analysis"
    ],
    "limitations": [
      "Does not fix network-level issues like firewalls blocking WebSocket connections",
      "Does not handle browser-specific WebSocket API limitations or bugs",
      "Does not generate code for WebSocket client implementations",
      "Focused on ws library in Node.js - may not apply to other WebSocket libraries"
    ],
    "use_cases": [
      {
        "target_user": "Backend Developer",
        "title": "Fix Multiple WSS Conflicts",
        "description": "Resolve WebSocketServer instances interfering with each other when attached to the same HTTP server using the server option."
      },
      {
        "target_user": "Full-Stack Engineer",
        "title": "Debug Connection Disconnects",
        "description": "Investigate why WebSocket connects then immediately disconnects with code 1006 or receives garbage data instead of expected messages."
      },
      {
        "target_user": "DevOps Engineer",
        "title": "Diagnose Frame Corruption",
        "description": "Use raw frame inspection to determine if errors are caused by compression mismatches, raw HTTP on sockets, or actual frame corruption."
      }
    ],
    "prompt_templates": [
      {
        "title": "Quick Error Lookup",
        "scenario": "See an unfamiliar WebSocket error",
        "prompt": "I'm getting this WebSocket error: [paste error message]. Help me understand what causes it and how to fix it."
      },
      {
        "title": "RSV1 Error Fix",
        "scenario": "Client reports RSV1 must be clear",
        "prompt": "My WebSocket client is throwing 'RSV1 must be clear' error. Walk me through the common causes and solution steps."
      },
      {
        "title": "Raw Frame Debugging",
        "scenario": "Need to inspect WebSocket bytes",
        "prompt": "Show me how to inspect raw WebSocket frames to debug what's actually being sent over the connection."
      },
      {
        "title": "Multiple Server Fix",
        "scenario": "Multiple WebSocketServer instances causing issues",
        "prompt": "I have two WebSocketServer instances on different paths but they're conflicting. How do I properly route upgrades without conflicts?"
      }
    ],
    "output_examples": [
      {
        "input": "My WebSocket server logs success but the client receives garbage data and shows 'Invalid frame header' error.",
        "output": [
          "This is the classic 'raw HTTP on WebSocket' bug. Here's what to check:",
          "â€¢ Most common cause: Multiple WebSocketServer instances attached to the same HTTP server",
          "â€¢ When both servers try to handle the upgrade, the non-matching one sends HTTP 400 to the socket",
          "â€¢ That HTTP text then gets interpreted as WebSocket frame data - the first byte 'H' (0x48) sets RSV1 and triggers your error",
          "â€¢ Solution: Use noServer:true mode with a single upgrade handler that routes to the correct server based on pathname"
        ]
      }
    ],
    "best_practices": [
      "Use noServer:true mode when attaching multiple WebSocketServer instances to prevent upgrade handler conflicts",
      "Always verify perMessageDeflate settings match between client and server to avoid RSV1 errors",
      "Check raw bytes first when debugging - hex starting with 48545450 means raw HTTP was written to the WebSocket"
    ],
    "anti_patterns": [
      "Attaching multiple WebSocketServer instances with the server option without manual routing",
      "Assuming RSV1 errors always mean compression issues - raw HTTP can produce the same symptom",
      "Not checking what else might be writing to the socket during the upgrade process"
    ],
    "faq": [
      {
        "question": "What causes 'Invalid frame header' WebSocket errors?",
        "answer": "Most often caused by raw HTTP being written to an upgraded WebSocket socket, or multiple WebSocketServer instances conflicting on the same server."
      },
      {
        "question": "Why do I see 'RSV1 must be clear' error?",
        "answer": "RSV1 indicates the frame has an extension set. Common causes include compression mismatches or raw HTTP text being interpreted as WebSocket frames."
      },
      {
        "question": "How do I prevent multiple WebSocketServer conflicts?",
        "answer": "Use noServer:true mode on all WebSocketServer instances and create a single upgrade handler that routes connections based on the URL pathname."
      },
      {
        "question": "What does WebSocket code 1006 mean?",
        "answer": "Abnormal closure - the connection was closed without a proper close frame. Often caused by server-side abortHandshake calls or the server crashing."
      },
      {
        "question": "Is this skill safe to use?",
        "answer": "Yes. This is a documentation skill with no executable code. It provides debugging guidance and code examples for development use only."
      },
      {
        "question": "Does this skill work with other WebSocket libraries?",
        "answer": "The concepts apply generally but the specific code examples target the popular ws library for Node.js. Adjust patterns for other libraries."
      }
    ]
  },
  "file_structure": [
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "SKILL.md"
    }
  ]
}
